<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Monikina Kuhinja</title>
    
    <style>
        /* OSNOVNI STIL - SPRJEƒåAVA RAZVLAƒåENJE */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: -apple-system, sans-serif; 
            background: #f0f2f5; 
            margin: 0; 
            padding: 10px; 
            display: flex; 
            justify-content: center; 
        }

        .app-card { 
            background: white; 
            padding: 15px; 
            border-radius: 20px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); 
            width: 100%; 
            max-width: 400px; /* Dr≈æi aplikaciju uskom */
        }

        header { text-align: center; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        h1 { margin: 5px 0; color: #2c3e50; font-size: 20px; }

        /* KARTICE NAMIRNICA */
        .food-item { 
            background: #fff; 
            border: 1px solid #eee; 
            border-left: 6px solid #e67e22; 
            padding: 12px; 
            border-radius: 15px; 
            margin-bottom: 12px; 
            position: relative; 
        }
        .delete-btn { position: absolute; top: 10px; right: 10px; background: none; border: none; font-size: 18px; color: #ddd; cursor: pointer; }
        .food-header { font-weight: bold; font-size: 18px; margin-bottom: 10px; color: #2c3e50; }

        /* KALKULATOR DIO */
        .calc-row { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; background: #f8f9fa; padding: 10px; border-radius: 10px; }
        input[type="number"] { width: 70px; padding: 8px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; }
        .ml-result { color: #2980b9; font-weight: 800; font-size: 16px; }

        /* TAJMER DIO */
        .timer-row { display: flex; justify-content: space-between; align-items: center; }
        .time-display { font-size: 24px; font-weight: bold; font-family: monospace; color: #2c3e50; }
        button { cursor: pointer; border: none; border-radius: 10px; font-weight: bold; transition: 0.2s; }
        .btn-cook { background: #3498db; color: white; padding: 10px 18px; }
        .btn-stop { background: #e74c3c; color: white; padding: 10px 18px; }

        /* POVIJEST I DODAVANJE */
        .add-section { margin-top: 20px; padding: 15px; border-radius: 15px; background: #fafafa; border: 1px dashed #ccc; }
        .add-section input { width: 100%; margin-bottom: 8px; padding: 10px; border: 1px solid #ddd; border-radius: 8px; }
        .btn-add { width: 100%; padding: 12px; background: #27ae60; color: white; }
        
        #history-list { max-height: 150px; overflow-y: auto; font-size: 13px; margin-top: 10px; background: #f9f9f9; padding: 5px; border-radius: 8px; }
        .history-item { padding: 6px; border-bottom: 1px solid #eee; color: #555; }
        
        @keyframes blink { 50% { opacity: 0.3; } }
        .finished { color: #e74c3c !important; animation: blink 0.8s infinite; }
    </style>
</head>
<body>

<div class="app-card">
    <header><h1>üç≥ Monikina Kuhinja</h1></header>
    
    <div id="food-list"></div>

    <div class="add-section">
        <h4 style="margin:0 0 10px 0">‚ûï Dodaj namirnicu</h4>
        <input type="text" id="newName" placeholder="Naziv">
        <input type="number" id="newTime" placeholder="Minuta">
        <input type="number" id="newWater" placeholder="ml vode">
        <input type="number" id="newGrams" placeholder="grama">
        <button class="btn-add" onclick="addNewFood()">SPREMI</button>
    </div>
    
    <div style="margin-top:20px; border-top: 2px solid #eee; padding-top:10px;">
        <h4 style="margin:0">üìú Povijest kuhanja</h4>
        <div id="history-list"></div>
        <button onclick="clearHistory()" style="margin-top:8px; background:none; color:#e74c3c; font-size:11px; border:1px solid #e74c3c; width:100%; padding:5px;">Obri≈°i povijest</button>
    </div>
</div>

<script>
    // --- PODACI ---
    let history = JSON.parse(localStorage.getItem('monika_history')) || [];
    const defaultFoods = [
        { name: "Ri≈æa", time: 25, water: 280, grams: 35 },
        { name: "Griz", time: 4, water: 300, grams: 40 },
        { name: "Palenta", time: 10, water: 300, grams: 40 }
    ];
    let foods = JSON.parse(localStorage.getItem('monika_foods')) || defaultFoods;
    let activeIntervals = {};
    let audioCtx = null;

    // --- FUNKCIJE ---
    function render() {
        const list = document.getElementById('food-list');
        list.innerHTML = '';
        foods.forEach((f, i) => {
            // Pametna formula za ri≈æu ostaje: (grami * 2.5) + 192
            const startMl = f.name.includes("Ri≈æa") ? Math.round((f.grams * 2.5) + 192) : f.water;
            
            list.innerHTML += `
                <div class="food-item">
                    <button class="delete-btn" onclick="deleteFood(${i})">üóëÔ∏è</button>
                    <div class="food-header">${f.name}</div>
                    <div class="calc-row">
                        <input type="number" id="in-${i}" value="${f.grams}" oninput="updateWater(${i}, this.value)">
                        <span>g ‚û°Ô∏è</span>
                        <span class="ml-result" id="res-${i}">${startMl} ml</span>
                    </div>
                    <div class="timer-row">
                        <div class="time-display" id="disp-${i}">${f.time}:00</div>
                        <button class="btn-cook" id="btn-${i}" onclick="toggleTimer(${i})">KUHAJ</button>
                    </div>
                </div>`;
        });
    }

    function updateWater(i, val) {
        const f = foods[i];
        let res = f.name.includes("Ri≈æa") 
            ? (val > 0 ? Math.round((val * 2.5) + 192) : 0)
            : (val > 0 ? Math.round((val / f.grams) * f.water) : 0);
        document.getElementById(`res-${i}`).innerText = res + " ml";
    }

    function toggleTimer(i) {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const btn = document.getElementById(`btn-${i}`);
        
        if (activeIntervals[i]) {
            clearInterval(activeIntervals[i]);
            delete activeIntervals[i];
            render();
        } else {
            let seconds = foods[i].time * 60;
            let saved = false;
            btn.innerText = "STOP";
            btn.classList.add('btn-stop');

            activeIntervals[i] = setInterval(() => {
                seconds--;
                if (seconds <= 0) {
                    const d = document.getElementById(`disp-${i}`);
                    d.innerText = "GOTOVO!";
                    d.classList.add('finished');
                    if (!saved) {
                        saveToHistory(foods[i].name, document.getElementById(`in-${i}`).value, document.getElementById(`res-${i}`).innerText);
                        saved = true;
                        playAlarm();
                    }
                } else {
                    let m = Math.floor(seconds / 60);
                    let s = seconds % 60;
                    document.getElementById(`disp-${i}`).innerText = `${m}:${s < 10 ? '0' : ''}${s}`;
                }
            }, 1000);
        }
    }

    function saveToHistory(name, g, ml) {
        const now = new Date();
        const entry = `${now.getHours()}:${(now.getMinutes()<10?'0':'')+now.getMinutes()} - ${name}: ${g}g (${ml})`;
        history.unshift(entry);
        if(history.length > 10) history.pop();
        localStorage.setItem('monika_history', JSON.stringify(history));
        renderHistory();
    }

    function renderHistory() {
        document.getElementById('history-list').innerHTML = history.map(h => `<div class="history-item">${h}</div>`).join('');
    }

    function playAlarm() {
        if(!audioCtx) return;
        const osc = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        osc.type = 'square'; osc.frequency.value = 880;
        g.gain.setValueAtTime(0.1, audioCtx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 1);
        osc.connect(g); g.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + 1);
    }

    function addNewFood() {
        const n = document.getElementById('newName').value;
        const t = document.getElementById('newTime').value;
        const w = document.getElementById('newWater').value;
        const g = document.getElementById('newGrams').value;
        if(n && t && w && g) {
            foods.push({ name: n, time: parseInt(t), water: parseInt(w), grams: parseInt(g) });
            localStorage.setItem('monika_foods', JSON.stringify(foods));
            render();
            document.getElementById('newName').value = '';
        }
    }

    function deleteFood(i) {
        if(confirm("Obri≈°i?")) {
            foods.splice(i, 1);
            localStorage.setItem('monika_foods', JSON.stringify(foods));
            render();
        }
    }

    function clearHistory() { history = []; localStorage.removeItem('monika_history'); renderHistory(); }

    render();
    renderHistory();
</script>

</body>
</html>
